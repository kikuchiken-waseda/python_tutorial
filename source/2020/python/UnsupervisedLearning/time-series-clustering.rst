===========================
時系列クラスタリング
===========================

- 文責: takuya.waseda.1119@gmail.com
- 作成日: 2020-05-20


.. contents::
    :depth: 2

基本的にクラスタリングでは横断的データ (cross-sectional data) のみを扱ってきた.
横断的データとは，複数の対象に対してある 1 つの時点での観測点のみがあるデータを指す.
これらのデータセットに対して教師なし学習を行い,
データの背後にある構造を学習したり，ラベルなしで類似したグループを分たりするわけです.

教師なし学習は時系列データ (time series data) に対しても非常に有用です.
時系列データとは一つの対象に対して様々な時点での観測点があるようなデータを指す.
特定の瞬間におけるデータの背後にある構造ではなく，
時系列に沿った構造を学習することのできるシステムを開発する必要があります.
そのようなシステムを開発できれば，類似した時系列パターンを特定し, グループに分けることが可能になります.

データ
===========================

時系列クラスタリング問題を分かりやすくするために,
実世界の問題を考えてみましょう.
医療機関に勤めていて,
心電図 (ECG: electrocardiogram) を分析しなければならないとしよう.
心電計は通常およそ, 10 sec の活動を記録します.

殆どの心電図には正常な心拍が記録されますが,
心不全などの問題がある場合には, 異常が生じるはずです.
これを検知するのが今回の課題になります.

実際には, 心電図はあまり綺麗には取れないため,
心電図をいくつかのグループに分類することは,
難しい問題になります.

波の振幅 (amplitude), 周期, 位相シフト, 垂直シフトなどが変動するので,
機械学習ベールのクラス分類器には，学習が容易ではないものになります.

アプローチ
===========================

時系列クラスタリングを行うなら，
どのような方法をとるにせよ, 歪みに対応しなければいけません.
一般的なクラスタリングアルゴリズムは，何らかの距離尺度を用いて
データ間の近さを決定し, それを用いて類似したデータ同士がグループを構成することで,
独立で均質なクラスタを構成していきます.

時系列データのクラスタリングも同様に行うわけですが,
振幅, 周期, 位相シフト, 垂直シフトなどの些細な相違にとらわれることなく,
類似した時系列データを一つのグループにまとめるには,
縮小, 拡大や, 上下, 左右シフトに影響されない距離尺度が必要になります.

k-Shape 法
----------------------------

時系列クラスタリングにおいて, 現在最も手軽に使用できる手法が, k-Shape 法です.
これは, 上記基準を満たしています.
つまり k-Shape 法では, スケール変換や
シフト変換によって変化しない距離尺度を使用します.
これによって, 時系列データの形状を保ったまま比較することが可能になります.
正規化された相互相関を用いてクラスタのセントロイドを計算し,
繰り返しのたびに, 時系列データのクラスタへの割り当てを更新します.

k-Shape 法はスケール変換やシフト変換に対して普遍であるだけでなく,
アプリケーション領域や問題の大きさにも影響されないという特長があります.
この特長により最小限のパラメータ調整で対応することが可能になります.
k-Shape 法はセントロイドの更新を繰り返しますが,
この過程の計算量はデータ数に対し線形です.

k-Shape 法の動作は K平均法に似ています.
いずれも, データとセントロイドの距離に基づいてデータのグループへの割り当てを繰り返す手法です.
この二つの手法の最大の相違点は, 距離の計算方法です.
k-Shape 法では相互相関を用いた形状に基づく距離が使用されます.

実例
===============================

では, k-shape 法を用いて, 時系列クラスタリングモデルを構築してみましょう．
ここでは, カリフォルニア大学リバーサイド校の時系列データコレクション(UCR Time Series Classification Archive) を使用します.
ファイルデータは 100MB を超えるので, GITHUB 上にデータを置くことができないので,
以下のURLからデータを入手してください.

- https://www.cs.ucr.edu/~eamonn/time_series_data/UCR_TS_Archive_2015.zip
